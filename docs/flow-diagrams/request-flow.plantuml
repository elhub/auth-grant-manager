@startuml request-flow

actor EndUser
participant MarketParty
box "Elhub" #LightBlue
participant ConsentHandler
participant MyPage
participant EMIF
end box

EndUser -> MarketParty: Initiates transaction
MarketParty -> ConsentHandler: POST /consent-request
ConsentHandler -> MarketParty: 201 Created (consentRequestId)
MarketParty -> MyPage: Redirect to https://mypage.elhub.no/consent-request/{consentRequestId}
MyPage -> MarketParty: Redirect to chosen MarketParty URI
note right
User accepts or rejects the request
consentId returned in the response
end note
MarketParty -> ConsentHandler: GET /consent-request/{consentRequestId}
ConsentHandler -> MarketParty: 200 OK (consentId)
note right
Retrieves consent request status
end note
MarketParty -> EMIF: Send BRS with consentId
note right
EMIF validates the consentId
end note

@enduml
